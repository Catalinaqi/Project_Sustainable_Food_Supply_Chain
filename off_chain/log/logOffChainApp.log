2025-05-17 10:28:38,202 - app_logger - INFO - [log_load_setting.py:69] - BackEnd: INITIAL LOADING OF GLOBAL - LOGGER
2025-05-17 10:28:38,202 - app_logger - INFO - [log_load_setting.py:70] - BackEnd: Logger initialized successfully (File logging: enabled)
2025-05-17 10:28:38,295 - app_logger - INFO - [database.py:24] - BackEnd: get_connection: Name database is: sfs_chain_database.db
2025-05-17 10:28:38,296 - app_logger - INFO - [database.py:25] - BackEnd: get_connection: Path for the database is: C:\Users\fabio\Documents\GitHub\Project_Sustainable_Food_Supply_Chain\off_chain\database\sfs_chain_database.db
2025-05-17 10:28:38,297 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Richiesta with params: ()
2025-05-17 10:28:38,301 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Magazzino with params: ()
2025-05-17 10:28:38,302 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS ComposizioneLotto with params: ()
2025-05-17 10:28:38,303 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Azioni_compensative with params: ()
2025-05-17 10:28:38,303 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Certificato with params: ()
2025-05-17 10:28:38,304 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Operazione with params: ()
2025-05-17 10:28:38,305 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Prodotto with params: ()
2025-05-17 10:28:38,305 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Soglie with params: ()
2025-05-17 10:28:38,306 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Azienda with params: ()
2025-05-17 10:28:38,307 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: DROP TABLE IF EXISTS Credenziali with params: ()
2025-05-17 10:28:38,308 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE  Credenziali (
                Id_credenziali INTEGER PRIMARY KEY AUTOINCREMENT,
                Username TEXT UNIQUE NOT NULL,
                Password TEXT NOT NULL                
            )
             with params: ()
2025-05-17 10:28:38,308 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE  Soglie (
                Operazione TEXT NOT NULL,
                Prodotto INTEGER NOT NULL,
                Soglia_Massima INTEGER NOT NULL,
                firma TEXT NOT NULL,
                PRIMARY KEY (Operazione, Prodotto)
            )
             with params: ()
2025-05-17 10:28:38,309 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE  Azienda (
                Id_azienda INTEGER PRIMARY KEY AUTOINCREMENT,
                Id_credenziali INTEGER NOT NULL,
                Tipo TEXT CHECK(Tipo IN ('Agricola', 'Trasportatore', 'Trasformatore', 'Rivenditore', 'Certificatore')),
                Nome TEXT NOT NULL,
                Indirizzo TEXT NOT NULL,
                Co2_emessa REAL NOT NULL DEFAULT 0,
                Co2_compensata REAL NOT NULL DEFAULT 0,
                Token INTEGER NOT NULL DEFAULT 100,
                CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (Id_credenziali) REFERENCES Credenziali(Id_credenziali) ON DELETE CASCADE
            )
             with params: ()
2025-05-17 10:28:38,310 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE  Prodotto (
                Id_prodotto INTEGER PRIMARY KEY AUTOINCREMENT,
                Nome TEXT NOT NULL,
                Stato INTEGER,
                Data_di_inserimento TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
             with params: ()
2025-05-17 10:28:38,311 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE  Operazione (
                Id_operazione INTEGER PRIMARY KEY AUTOINCREMENT,
                Id_azienda INTEGER NOT NULL,
                Id_prodotto INTEGER NOT NULL,
                Id_lotto INTEGER UNIQUE NOT NULL,
                Data_operazione TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                Consumo_CO2 REAL NOT NULL,
                quantita REAL NOT NULL CHECK(quantita > 0),
                Tipo TEXT CHECK(tipo IN ('produzione', 'trasporto', 'trasformazione', 'vendita')) NOT NULL,
                FOREIGN KEY (Id_azienda) REFERENCES Azienda(Id_azienda) ON DELETE CASCADE,
                FOREIGN KEY (Id_prodotto) REFERENCES Prodotto(Id_prodotto) ON DELETE CASCADE
            )
             with params: ()
2025-05-17 10:28:38,311 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE ComposizioneLotto (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                id_lotto_output INTEGER NOT NULL,
                id_lotto_input INTEGER NOT NULL,
                quantità_utilizzata REAL NOT NULL CHECK(quantità_utilizzata > 0),
                FOREIGN KEY (id_lotto_input) REFERENCES Operazione(Id_lotto)
            )
             with params: ()
2025-05-17 10:28:38,312 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE  Certificato (
                Id_certificato INTEGER PRIMARY KEY AUTOINCREMENT,
                Id_lotto INTEGER NOT NULL,
                Descrizione TEXT,
                Id_azienda_certificatore INTEGER NOT NULL,
                Data TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (Id_azienda_certificatore) REFERENCES Azienda(Id_azienda) ON DELETE CASCADE
            )
             with params: ()
2025-05-17 10:28:38,313 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE  Azioni_compensative (
                Id_azione INTEGER PRIMARY KEY AUTOINCREMENT,
                Data TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                Id_azienda INTEGER NOT NULL,
                Co2_compensata REAL NOT NULL,
                Nome_azione TEXT NOT NULL,
                FOREIGN KEY (Id_azienda) REFERENCES Azienda(Id_azienda) ON DELETE CASCADE
            )
             with params: ()
2025-05-17 10:28:38,314 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE Magazzino (
                id_azienda TEXT NOT NULL,
                id_lotto TEXT NOT NULL,
                quantita REAL NOT NULL CHECK(quantita >= 0),
                PRIMARY KEY (id_azienda, id_lotto),
                FOREIGN KEY (id_azienda) REFERENCES Azienda(Id_azienda),
                FOREIGN KEY (id_lotto) REFERENCES Operazione(Id_lotto)
)
             with params: ()
2025-05-17 10:28:38,315 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            CREATE TABLE  Richiesta (
                Id_richiesta INTEGER PRIMARY KEY AUTOINCREMENT,
                Id_richiedente INTEGER NOT NULL,
                Id_ricevente INTEGER NOT NULL,
                Id_trasportatore INTEGER NOT NULL,
                Id_prodotto INTEGER NOT NULL,
                Quantita REAL NOT NULL,
                Stato_ricevente TEXT CHECK(Stato_ricevente IN ('In attesa', 'Accettata', 'Rifiutata')),
                Stato_trasportatore TEXT CHECK(Stato_trasportatore IN ('In attesa', 'Accettata', 'Rifiutata')),
                Data TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (Id_richiedente) REFERENCES Azienda(Id_azienda) ON DELETE CASCADE
                FOREIGN KEY (Id_ricevente) REFERENCES Azienda(Id_azienda) ON DELETE CASCADE
                FOREIGN KEY (Id_trasportatore) REFERENCES Azienda(Id_azienda) ON DELETE CASCADE
            )
             with params: ()
2025-05-17 10:28:38,320 - app_logger - INFO - [db_migrations.py:153] - BackEnd: run_migrations: Migrations completed successfully.
2025-05-17 10:28:38,839 - app_logger - INFO - [db_migrations.py:397] - Seed dei dati iniziali completato.
2025-05-17 10:28:38,840 - app_logger - INFO - [db_migrations.py:164] - BackEnd: run_migrations: Seed dei dati iniziali completato.
2025-05-17 10:28:38,877 - app_logger - INFO - [gui_manager.py:16] - Frontend: Starting the PyQt application...
2025-05-17 10:28:38,878 - app_logger - INFO - [gui_manager.py:18] - Start session on 2025/05/17/10-28
2025-05-17 10:28:40,004 - app_logger - INFO - [blockchain_manager.py:30] - Docker Desktop is already running
2025-05-17 10:28:40,006 - app_logger - INFO - [automated_deployment.py:20] - Stopping any existing containers...
2025-05-17 10:28:45,257 - app_logger - INFO - [automated_deployment.py:28] - Starting containers with Docker Compose...
2025-05-17 10:28:47,833 - app_logger - INFO - [automated_deployment.py:52] - Docker Compose services started successfully
2025-05-17 10:28:47,833 - app_logger - INFO - [automated_deployment.py:55] - Waiting for Ganache to initialize...
2025-05-17 10:28:52,876 - app_logger - INFO - [automated_deployment.py:65] - Successfully connected to Ganache. 10 accounts available.
2025-05-17 10:28:57,881 - app_logger - INFO - [blockchain_manager.py:149] - Waiting for Ganache to be ready...
2025-05-17 10:28:57,946 - app_logger - INFO - [blockchain_manager.py:166] - Successfully connected to Ganache with 10 accounts
2025-05-17 10:28:57,963 - app_logger - INFO - [blockchain_manager.py:123] - Backed up contract addresses to C:\Users\fabio\Documents\GitHub\Project_Sustainable_Food_Supply_Chain\on_chain\contract_addresses_backup_20250517_102857.json
2025-05-17 10:28:57,983 - solcx - INFO - [install.py:470] - solc 0.8.0 already installed at: C:\Users\fabio\.solcx\solc-v0.8.0
2025-05-17 10:28:58,050 - app_logger - ERROR - [blockchain_manager.py:104] - Blockchain setup error: ParserError: Source "@openzeppelin/contracts/access/Ownable.sol" not found: File outside of allowed directories.
 --> SupplyChainCO2.sol:6:1:
  |
6 | import "@openzeppelin/contracts/access/Ownable.sol";
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


ParserError: Source "@openzeppelin/contracts/access/AccessControl.sol" not found: File outside of allowed directories.
 --> SupplyChainCO2.sol:7:1:
  |
7 | import "@openzeppelin/contracts/access/AccessControl.sol";
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


> command: `C:\Users\fabio\.solcx\solc-v0.8.0\solc.exe --standard-json`
> return code: `0`
> stdout:
{"errors":[{"component":"general","errorCode":"6275","formattedMessage":"ParserError: Source \"@openzeppelin/contracts/access/Ownable.sol\" not found: File outside of allowed directories.\n --> SupplyChainCO2.sol:6:1:\n  |\n6 | import \"@openzeppelin/contracts/access/Ownable.sol\";\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n","message":"Source \"@openzeppelin/contracts/access/Ownable.sol\" not found: File outside of allowed directories.","severity":"error","sourceLocation":{"end":179,"file":"SupplyChainCO2.sol","start":127},"type":"ParserError"},{"component":"general","errorCode":"6275","formattedMessage":"ParserError: Source \"@openzeppelin/contracts/access/AccessControl.sol\" not found: File outside of allowed directories.\n --> SupplyChainCO2.sol:7:1:\n  |\n7 | import \"@openzeppelin/contracts/access/AccessControl.sol\";\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n","message":"Source \"@openzeppelin/contracts/access/AccessControl.sol\" not found: File outside of allowed directories.","severity":"error","sourceLocation":{"end":238,"file":"SupplyChainCO2.sol","start":180},"type":"ParserError"}],"sources":{}}

> stderr:
2025-05-17 10:28:58,052 - app_logger - WARNING - [gui_manager.py:37] - Proceeding without blockchain functionality
2025-05-17 10:28:58,052 - app_logger - ERROR - [gui_manager.py:39] - Blockchain setup failed: ParserError: Source "@openzeppelin/contracts/access/Ownable.sol" not found: File outside of allowed directories.
 --> SupplyChainCO2.sol:6:1:
  |
6 | import "@openzeppelin/contracts/access/Ownable.sol";
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


ParserError: Source "@openzeppelin/contracts/access/AccessControl.sol" not found: File outside of allowed directories.
 --> SupplyChainCO2.sol:7:1:
  |
7 | import "@openzeppelin/contracts/access/AccessControl.sol";
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


> command: `C:\Users\fabio\.solcx\solc-v0.8.0\solc.exe --standard-json`
> return code: `0`
> stdout:
{"errors":[{"component":"general","errorCode":"6275","formattedMessage":"ParserError: Source \"@openzeppelin/contracts/access/Ownable.sol\" not found: File outside of allowed directories.\n --> SupplyChainCO2.sol:6:1:\n  |\n6 | import \"@openzeppelin/contracts/access/Ownable.sol\";\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n","message":"Source \"@openzeppelin/contracts/access/Ownable.sol\" not found: File outside of allowed directories.","severity":"error","sourceLocation":{"end":179,"file":"SupplyChainCO2.sol","start":127},"type":"ParserError"},{"component":"general","errorCode":"6275","formattedMessage":"ParserError: Source \"@openzeppelin/contracts/access/AccessControl.sol\" not found: File outside of allowed directories.\n --> SupplyChainCO2.sol:7:1:\n  |\n7 | import \"@openzeppelin/contracts/access/AccessControl.sol\";\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n","message":"Source \"@openzeppelin/contracts/access/AccessControl.sol\" not found: File outside of allowed directories.","severity":"error","sourceLocation":{"end":238,"file":"SupplyChainCO2.sol","start":180},"type":"ParserError"}],"sources":{}}

> stderr:
2025-05-17 10:28:59,054 - app_logger - INFO - [credential_repository_impl.py:32] - BackEnd: Successfully initializing the instance for CredentialRepositoryImpl.
2025-05-17 10:28:59,054 - app_logger - INFO - [credential_controller.py:19] - BackEnd: Successful initialization of 'class instances' for repository implements
2025-05-17 10:29:07,749 - app_logger - INFO - [credential_repository_impl.py:38] - [(1, 'aaa', '3f0409ad2ac4570392adef46536c00e46c60d702d3822788319590de4c146a45')]
2025-05-17 10:29:07,750 - app_logger - INFO - [credential_controller.py:43] - Username inserito: aaa, Password inserita: 12345Aa@
2025-05-17 10:29:07,751 - app_logger - INFO - [credential_controller.py:50] - Username aaa ha eseguito l'accesso
2025-05-17 10:29:09,041 - app_logger - INFO - [company_controller.py:54] - BackEnd: Successful initialization of 'class instances' for repository implements
2025-05-17 10:29:10,524 - app_logger - INFO - [company_controller.py:54] - BackEnd: Successful initialization of 'class instances' for repository implements
2025-05-17 10:29:11,948 - app_logger - INFO - [company_controller.py:54] - BackEnd: Successful initialization of 'class instances' for repository implements
2025-05-17 10:29:16,598 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query: 
            INSERT INTO Azioni_compensative (Data, Id_azienda, Co2_compensata, Nome_azione)
            VALUES (?, ?, ?, ?);
             with params: ('2025-05-17', 1, 1.0, 'qqq')
2025-05-17 10:29:16,600 - app_logger - INFO - [database.py:116] - BackEnd: execute_transaction: Info executing query:  UPDATE Azienda  SET Co2_compensata = Co2_compensata + ? 
            WHERE Id_azienda = ?; with params: (1.0, 1)
2025-05-17 10:29:16,605 - app_logger - INFO - [compensation_action_repository_impl.py:86] - Azione compensativa aggiunta con successo
